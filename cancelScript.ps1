$subscriptionId = "6d21062f-5a04-499e-9c7f-0ebf4bf6ff0f"

$resourceGroup = "zcac-rg-prod-integrations"

$logicAppName = "zcac-logicapps-prod-integrations"

$workflowName = "sb-http-d365fo-oiInvoice-createJournal"




$token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyIsImtpZCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9mMjYzMjdlMy1kMDRkLTRhOGMtODI1MS05YTc2Njk2OGU3N2EvIiwiaWF0IjoxNjkwODEyMzkwLCJuYmYiOjE2OTA4MTIzOTAsImV4cCI6MTY5MDgxNjMwNiwiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhVQUFBQWhUaWgzTVhKWWZaY3FjTGhLWjJJaXFzb1VNMVNPbUZiUFV0a3dRdld4U01xOHY0NWRZMDNiN0NwOURvK0xIYnZ4QnprVmFDMGp2V0dNZExuNEFDRUp2NWIrMVc5QUJXT0JzY3pnTGtPZStrPSIsImFtciI6WyJwd2QiLCJyc2EiLCJtZmEiXSwiYXBwaWQiOiJjNDRiNDA4My0zYmIwLTQ5YzEtYjQ3ZC05NzRlNTNjYmRmM2MiLCJhcHBpZGFjciI6IjAiLCJkZXZpY2VpZCI6ImMyNjM1YzA0LTQwMDYtNGFmMi1hN2I2LWQxYmYzZWZkODQ0YyIsImZhbWlseV9uYW1lIjoiUGF5YXZ1bGEiLCJnaXZlbl9uYW1lIjoiUmFnaGF2ZW5kcmEiLCJncm91cHMiOlsiOWI0Y2FkMDEtMGM4Mi00MWQ2LTlhOTgtNmRhN2IzZWM0ZDUzIiwiZTExMzAwMDUtZjg0Zi00MjIzLWE3YjQtNDBiNzJmYjhkNWFiIiwiZjY1OGNiMDgtZGM0YS00NDdiLThmNzctNzZjZWZjODYwYTkzIiwiMGEwNWVhMGQtMzU5Zi00NTQ1LWFjYjgtODE4ZTJkOWZlY2Q3IiwiNDlhY2E5MGUtNzZjMS00YjNkLWE3ZTgtMDgyNmY3NWZjNDVjIiwiOGQyZjliMTEtZTAxNi00NzVjLTg0ZTItMTVmNWZkZDlkOWY0IiwiODYxYzAyMTItZThmYy00MTE2LWEwZmItZmEwZjNmNTU1YTkzIiwiYTVmYWJiMTQtNmIzOC00MjFjLTk0NDQtNjQyOTA5ODg3ZDUyIiwiZWZkNzE4MjEtZmQ0Ni00ZmVmLTg3MDctODU1MjMxYzRjNmZkIiwiMjFiN2MxMjYtOTZhOC00ZDgwLTg1ODktODU1YmI1ZWVjOTFjIiwiNDE0MzVlMjctNzExZS00ZTA0LTkwY2EtZDNhYmUwM2E5NWMwIiwiNjUyNTdlMjktMzk2Yy00ZmUxLTg1NGMtZGZmYTkzOGVkNjhmIiwiODc2NmFkMjktNWUxMy00YTg0LWFlZDItMGY3M2EyMzY3N2IxIiwiMTkyZWQwMmMtMjUxNS00ZDE2LWI0YjgtZGM5N2QyMmE5YjIxIiwiMmNhNDM5MzAtMTU4MC00YzgxLTgzYjktZGI2OTExYzVjMDIwIiwiZTJiYWE4M2ItYzY1My00N2IxLWFiYjUtYWIyMWI4ZDkzMjY0IiwiZDM4ZTBhM2MtNDVkYS00OTg0LWI4OWYtNzA2MWU3NzU4MmZlIiwiNjM3NzIxM2YtNzBhNC00OGIwLWIzMDQtODQyYjE0ODIwNTI2IiwiZGRkMWJmNDAtYTU4Ny00NzM4LThiNzQtNDk5YWU4ZWNiNTlhIiwiNjVjYjA3NDMtMGI1Ny00M2JiLWE4ZGYtOTUzZGY2ZTZmNDg3IiwiMzY1ZTQ5NDgtOWEyMy00N2I3LWFmYWMtNTJmMjJjNTU5NWFiIiwiNGVmNzIzNGMtZWJkZi00NzkyLWEzMGQtYjRkYmM2YWJmN2U3IiwiODY3ZGIzNTQtOWI5MC00N2YyLWE4NzYtMGUxM2MwN2FhNDA2IiwiNGE1Yjc5NTYtOGEyNi00YjhkLWFlMTUtNmE3ZTIxMGZkMjk5IiwiZGM5YzczNTgtOWExYy00ZjNiLWEyZGYtMTYxMDdkZTA5YWUzIiwiZjI1ZWU4NWYtMDYwYS00MzI5LTljNjctZmNiNDM2ZGI5M2Q3IiwiZDUwMWY2NjEtMjk5MS00Njk0LWJlYzgtNjNhNTA2NjdlYzM1IiwiMjJkMmE1NjQtMmM1YS00NmU5LThkNDMtYzM5ZmQ3ODIyNzg5IiwiZjRiMzQ0NjUtMWZlZi00ZTM2LThmYWUtMjhiZTZlNzA5NjNkIiwiZWM1M2ZjNmItMzQzYi00MmQ2LWE5MzctYjFkZTNmNDc4NDAwIiwiZmU3NDRiNzItYWNlMy00MDMxLWJhM2YtZGJjNWI5MTA5ZTA2IiwiNmUwNWUzNzUtMGRkYS00NzBmLTg0NDgtZDJlOTYzYTRiNjc1IiwiNDc4NDFiNzgtNTUxMy00MTBmLTk0NmEtNzgxNGI3YmM0MTc1IiwiYzA1MmUwN2MtNmVlMy00NWJkLTllMTMtNjQ3YWI5ZDI3ZjhjIiwiMmViZWRmODItMDlmMS00MWExLThkNmUtYTU4OGRlYzBjNDU4IiwiMTY3ZWI0ODQtNjUzNS00ZWU4LWJkY2EtYTQ5M2IzZDM2ZmRkIiwiYjcwMzA2ODctYTU3OS00YzBkLTlhYjItZTAxODUzY2YxN2E3IiwiN2JjMzNhOGQtOTM5MC00OTBjLWE0OGQtMzdmNGJmMGI2M2UwIiwiMWM2NmYwOTAtODE4OS00NDUzLTk2NTMtYjQxMGFmMGE2YzYyIiwiYjYzMGNiOTItOTZmOC00MGJkLTk3ZDYtNGQyNjVhNzcxNjQ4IiwiMWFmZDc0OTYtOWE0NC00MDlhLThlYjktMzA5NzI1MzdmMjc1IiwiOTI3N2ZhOTgtYzI4My00MDc0LTg3NWQtY2Y5MjNjYTlmMDg5IiwiM2MwMDZlOTktMWE1ZS00OTc1LTk1Y2UtZTJjODY0MjI3ODgxIiwiZTc4MzdkOWItZWNlMi00Y2E1LTk1YzgtNjAxMWY4NjljZTZmIiwiYjAxMzFhYTQtZTFkZS00ZDliLWJjZTctZDcyNWQ5MzRmNTgxIiwiYThjYWE0YTktM2EyMS00YzMxLWJkOTUtNzZmY2Y3ZjhkMzA4IiwiN2IyYjIxYjAtNDU4Mi00MzEyLWJmMjktM2MxY2U3MzBhYmQxIiwiMGViNjdhYjUtN2I3OS00ODFmLWFkMmQtNmJhMDljYzBlOWJhIiwiYjc3MzA5YjgtNzc0My00ZWRiLTlkMTUtZWIwMmVjZTVkNGViIiwiMGExYjg0YjktNDBmOS00OGMxLTljOWQtZjIzNDAwZWExZjU5IiwiOTYyNjgwY2QtMWZiMC00MTQzLWI1NGQtYjFlNWIzNzY0ZWE3IiwiZDU5YjdjY2YtZTIyZS00ZWUyLTliZDgtZGU5OWUzMWJiZDNjIiwiY2M2M2EyZDEtOWQxMy00N2Y4LTg0YjYtODVmZGQ2OWZmNzA4IiwiMzNjOTY2ZDMtOGM4NS00OTJkLThmY2EtNTg1NWUzMjdkODQyIiwiNTM2MWM0ZDMtM2IzZi00NDBlLWI1ZjMtMmZhMTM4MDRlYjc0IiwiODM4ZjIzZDUtN2I0Yy00YzEwLWE4ZDAtZWNlMmZhMTRkNTlkIiwiNmRlMDgwZDctN2RjNi00MzdkLWIxNWQtYzdhYzE0ZjlkMzJhIiwiOTIwOTVkZDgtOTVjNC00OGI2LWIyN2MtMjQ5OWFhNWY4ZmQ5IiwiZTdmMDU1ZGEtMmRjOS00Yzk4LTgzZDAtYTQxMGJhOTA1ZTZlIiwiNzIxZTUzZGQtMDMyOC00OThmLWI1OGEtZjQ1MDljY2VlMWUzIiwiNjQ0ZjRmZGYtNTJhZC00OThkLTlhZTQtNjdiNDhlNzk4NzdmIiwiYjMyNmEyZTMtNTgxOS00MzkzLWE2NzQtM2QyYWViZDZlOTFjIiwiZmMyZTQxZTYtYWU0Ni00NmU1LThlOWUtZjJhOGVmY2RlMjJjIiwiNGY3MjI5ZWEtNDI3Yy00MTVlLTg4ODItNTNhNTBmMmZjNjRmIiwiY2U3MTgyZWQtZmU2Ni00OWJlLTk1MTgtOGJlZTU4MWViOTFjIiwiMDIzY2Y0ZjAtZWMxMC00OThiLTljZmQtMzNjNzkwYzZkZTJkIiwiYjU5MDFiZjQtYzJhZS00NTRhLTgwNDItZDE0NjhjNGIzMDQ2IiwiZTFiYmU5ZjktYTJlMy00NTE3LTkwNzAtNzVkOTA5OTI5MWUwIiwiMjYwMmQ1ZmYtNGUyMy00ZTJmLThkODEtMjY4MzlhY2IzN2FlIl0sImlwYWRkciI6IjI0MDY6NzQwMDo0MzoyODgxOjZkMWM6ZmRjNDphMmU3OmI0MWIiLCJuYW1lIjoiUmFnaGF2ZW5kcmEgUGF5YXZ1bGEiLCJvaWQiOiJjNGIyNzY0Yi01M2Y4LTQzZmEtYTMzZC1jN2M1OTkyZGZjZTciLCJvbnByZW1fc2lkIjoiUy0xLTUtMjEtMTI1MDI2ODQyNS00MTk4MDM0NjU1LTE1NTE4NTk0OC0yODI2OSIsInB1aWQiOiIxMDAzMjAwMTU2RTE0MUY1IiwicmgiOiIwLkFWc0E0eWRqOGszUWpFcUNVWnAyYVdqbmVrWklmM2tBdXRkUHVrUGF3ZmoyTUJOYkFJby4iLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJwTnZQZEJJRk41ellwWjBpekltczFWSTdROVM5STFBSloyOGVLeHZkWGhnIiwidGlkIjoiZjI2MzI3ZTMtZDA0ZC00YThjLTgyNTEtOWE3NjY5NjhlNzdhIiwidW5pcXVlX25hbWUiOiJycGF5YXZ1bGFAc2VjdXJlLWVuZXJneS5jb20iLCJ1cG4iOiJycGF5YXZ1bGFAc2VjdXJlLWVuZXJneS5jb20iLCJ1dGkiOiIxcDRHbW80a0JVNlBXdGNlcmIxekFBIiwidmVyIjoiMS4wIiwieG1zX3RjZHQiOjEzNTMxMDQwODN9.IEYeYd_e6uyEmWM1xntATQaiHLL97KoDnOs2L0QtIPN5aiGaWl84pBWQI2QHhSV_V2TLz5pk4aspsk4jNo0KTlkzdKk-HgrAQNqKPs6DyDEeFOXUfsEJrZEPehNl4hfOagPY696zypyYRE5dL51DWqB1ptSzmhJOyxNgAgIti6czN4QXnIZSJtXKOsZqiENVXo8hPgJkYkH_gjpmHhGte1tBvKKTcAJlrppCDKSnP6btSMWqAk7ewpaYFqjI8ziWptAbQt14RR5V5twvpL1A12tm-ZAqwCCvr2_dUEnCsKkFT4Yv0LteJabskemA21PnoX3qea8lCIqj5-7m_uUmSA"




# Get running jobs

$apiUrl = "https://management.azure.com/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Web/sites/$logicAppName/hostruntime/runtime/webhooks/workflow/api/management/workflows/$workflowName/runs?api-version=2022-03-01&`$top=250&`$filter=status eq 'Running'"




$headers = @{

 "Authorization" = "Bearer $token"

}




$jobs = Invoke-RestMethod -Method Get -Uri $apiUrl -Headers $headers




$jobs.value | ForEach-Object {

 Write-Host "Cancelling flow run: $($_.name) (Run start time was: $($_.properties.startTime))"




 $headers = $using:headers

 $subscriptionId = $using:subscriptionId
 $resourceGroup = $using:resourceGroup

 $logicAppName = $using:logicAppName

 $workflowName = $using:workflowName


 time.sleep(2)

 $cancelUrl = "https://management.azure.com/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.Web/sites/$logicAppName/hostruntime/runtime/webhooks/workflow/api/management/workflows/$workflowName/runs/$($_.name)/cancel?api-version=2022-03-01"




 Invoke-RestMethod -Method Post -Uri $cancelUrl -Headers $headers

}